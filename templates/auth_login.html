{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-5">
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-4 p-md-5">
          <div class="text-center mb-4">
            <div class="mb-2">
              <img src="{{ url_for('static', filename='img/logo.svg') }}"
                   alt="{{ site_name }}" height="36"
                   onerror="this.style.display='none'">
            </div>
            <h1 class="h4 mb-1">Welcome back</h1>
            <p class="text-muted small mb-0">Sign in to continue to {{ site_name }}</p>
          </div>

          <form method="post" id="loginForm" class="needs-validation" novalidate>
            <div class="mb-3">
              <label class="form-label" for="email">Email</label>
              <div class="input-group">
                <span class="input-group-text">@</span>
                <input type="email"
                       class="form-control" id="email" name="email"
                       required autocomplete="email"
                       placeholder="you@example.com" autofocus>
              </div>
              <div class="invalid-feedback">Please enter a valid email address.</div>
            </div>

            <div class="mb-3">
              <label class="form-label" for="password">Password</label>
              <div class="input-group">
                <input type="password"
                       class="form-control" id="password" name="password"
                       minlength="6" required autocomplete="current-password"
                       placeholder="••••••••">
                <button class="btn btn-outline-secondary" type="button"
                        id="togglePw" aria-label="Show password">Show</button>
              </div>
              <div class="invalid-feedback">Password is required (min 6 characters).</div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="rememberEmail">
                <label class="form-check-label" for="rememberEmail">Remember my email</label>
              </div>
              <a href="/contact-us" class="small text-muted">Forgot password?</a>
            </div>

            <div class="d-grid gap-2">
              <button class="btn btn-primary btn-lg" type="submit">Login</button>
              <a class="btn btn-outline-secondary" href="{{ url_for('signup') }}">Create account</a>
            </div>
          </form>
        </div>
      </div>

      <p class="text-center text-muted small mt-3">
        By continuing you agree to our
        <a href="#" class="text-decoration-underline">Terms</a> &
        <a href="#" class="text-decoration-underline">Privacy Policy</a>.
      </p>
    </div>
  </div>
</div>

<style>
  /* Subtle lift on focus for better UX */
  .form-control:focus, .btn:focus {
    box-shadow: 0 0 0 .2rem rgba(13,110,253,.15);
  }
</style>

<script>
(() => {
  const form = document.getElementById('loginForm');
  const emailEl = document.getElementById('email');
  const remember = document.getElementById('rememberEmail');
  const pw = document.getElementById('password');
  const toggle = document.getElementById('togglePw');

  // Remember email using localStorage (per browser)
  try {
    const saved = localStorage.getItem('gb_login_email');
    if (saved && !emailEl.value) {
      emailEl.value = saved;
      remember.checked = true;
    }
    remember.addEventListener('change', () => {
      if (remember.checked) {
        localStorage.setItem('gb_login_email', emailEl.value.trim());
      } else {
        localStorage.removeItem('gb_login_email');
      }
    });
    emailEl.addEventListener('input', () => {
      if (remember.checked) localStorage.setItem('gb_login_email', emailEl.value.trim());
    });
  } catch (_) {}

  // Show/hide password
  toggle.addEventListener('click', () => {
    const isHidden = pw.type === 'password';
    pw.type = isHidden ? 'text' : 'password';
    toggle.textContent = isHidden ? 'Hide' : 'Show';
    toggle.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
  });

  // Bootstrap-style client validation
  form.addEventListener('submit', (e) => {
    if (!form.checkValidity()) {
      e.preventDefault();
      e.stopPropagation();
    }
    form.classList.add('was-validated');
  }, false);
})();
</script>
{% endblock %}
